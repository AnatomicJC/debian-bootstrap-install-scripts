# Variables
DISKS=( 
  /dev/disk/by-id/ata-QEMU_HARDDISK_QM00003
  )
DEBIAN_RELEASE=buster
HOSTNAME=server
DOMAIN=local
FQDN=${HOSTNAME}.${DOMAIN}
PUBLIC_IP=127.0.1.1
# IFACE_NAME will be dhcp, adapt script for your needs
IFACE_NAME=enp1s0
CRYPTED_DISKS="/dev/mapper/crypt_disk_0"

_func_setup_install_packages () {
  apt install --no-install-recommends --yes debootstrap gdisk cryptsetup vim
  apt install --no-install-recommends --yes mdadm
}

_func_setup_mkfs () {
  mkfs.ext4 ${CRYPTED_DISKS}
  mount ${CRYPTED_DISKS} /mnt/
  mkdir /mnt/tmp
}

_func_setup_debootstrap_post () {
  return
}

_func_setup_umount () {
  return
}

_func_chroot_install_packages () {
  apt install --yes locales tzdata ssh linux-image-amd64 cryptsetup
}

_func_chroot_post_grub_install () {
  ROOT_UUID=$(ls -alh /dev/disk/by-uuid/ | grep dm-0 | awk '{print $9}')
  
  tune2fs -o journal_data_writeback /dev/disk/by-uuid/${ROOT_UUID}
  
  cat >> /etc/fstab << EOF
  UUID=${ROOT_UUID} /               ext4    noatime,data=writeback,barrier=0,nobh,errors=remount-ro 0       1
EOF
}
